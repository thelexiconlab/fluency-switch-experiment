<!DOCTYPE html>
<html>
<head>
    <title>
        jsPsych
    </title>

    <script src="https://unpkg.com/jspsych@7.3.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-multi-select@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@1.1.2"></script>
    <link href="https://unpkg.com/jspsych@7.3.0/css/jspsych.css" rel="stylesheet" type="text/css" /> 
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.1"></script>
    <script src="lists.js"></script>
    <script src="practice.js"></script>
</head>
<body>
<script>

const jsPsych = initJsPsych({
            on_finish: function() {
            jsPsych.data.displayData();
            }
            });

var timeline = [];

var Instructions1 = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `<p>Today you will be tasked with grouping consecutive items in a list </p>
         <p>You will be presented with a list of items and will be asked to mark when an item departs from the group of items beforehand</p>
         <p>Press Continue to complete a few practice lists </p>`,
        choices: ['Continue'],
    };

    timeline.push(Instructions1)
    
    

    var Practice = {
        type: jsPsychSurveyMultiSelect,
        questions: [
          {
            prompt: "Place a check next to each item that starts a new grouping:",
            options: jsPsych.timelineVariable("pr"),
            required: false
          }
    ]
    };

    var timeline_practice = {
      timeline: [Practice],
      timeline_variables: practicelist,
      randomize_order: true
    }

    timeline.push(timeline_practice)

    var Instructions2 = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `<p>Thank you for completing these practice lists. Now you will be asked to do the same thing for real </p>
         <p>Please be thoughtful when considering these lists, press Continue when you are ready</p>`,
        choices: ['Continue'],
    };

    timeline.push(Instructions2)

var trial = {
  type: jsPsychSurveyMultiSelect,
  questions: [
    {
      prompt: "Place a check next to each item that starts a new grouping:", 
      options: jsPsych.timelineVariable("word"),
      required: true,
      name: 'items'
    }, 
  ], 
  randomize_question_order: true
};

var changeofdomain = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `<p>You will now provide groupings on a new domain! </p>
         <p>Please click the button below to continue. </p>`,
        choices: ['Continue'],
    };


var teststimuli = []
var list = [1,2,3,4,5,6,7,8,9,10,11,12] // 12 lists

var CONDITION = list[Math.floor(Math.random() * list.length)];

//teststimuli = find_list(CONDITION)
teststimuli = list1

var domains = ["ANIMALS", "CITIES", "VEHICLES", "OCCUPATIONS", "SPORTS", "FOODS"]

var shuffledDomains = jsPsych.randomization.shuffle(domains);
//console.log("shuffledDomains=",shuffledDomains)

for( var i = 0; i < shuffledDomains.length; i++){
    console.log("i=",i)
    var domain_proc = {
      timeline: [trial],
      timeline_variables:  extract_json_subset(teststimuli, shuffledDomains[i]),
      randomize_order: true
    }

    timeline.push(domain_proc)

    if(i < shuffledDomains.length-1){
    timeline.push(changeofdomain)
    }

    }

    

    var demoinstructions = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `
    <p> You have completed the experiment portion! </p>
    <p>Before you are done, we would like you to answer some basic demographic questions. </p>
      <p>Note that your answers to these questions will not affect your compensation/credit. </p>
      <p> While some questions are required (*) to obtain some basic information about our recruitment sample <p>
        <p> you can choose to skip other questions that you do not feel comfortable answering. </p>
        <p>Click the button below to continue.</p>
    `,
    choices: ['Continue'],
        data: {
          typeoftrial: 'demo',
        }
    }; 

    timeline.push(demoinstructions)

    var demo_1 = {
        type: jsPsychSurveyText,
        questions: [
          {prompt: 'What is your age?', required: true, name: 'Age'},
          {prompt: 'What is your gender?', required: true, name: 'Gender'},
          {prompt: 'How many years of formal education have you had? (consider graduating high school to be 12 years)', 
          required: true, name: 'Education'}
        ],
        button_label: 'Next',
        data: {
          typeoftrial: 'demo',
          Experiment: jsPsych.timelineVariable('Experiment'),
        }
    };

    var demo_2 = {
  type: jsPsychSurveyMultiSelect,
  questions: [
    {
      prompt: "Please select all the racial categories that apply to you:", 
      options: ["American Indian/Alaskan Native","Asian", "Black/African American", 
      "Native Hawaiian or Other Pacific Islander" , 
       "White/Caucasian", "More than once race", "Other"], 
      horizontal: false,
      required: false,
      name: 'Race'
    }
  ],
  data: {
          typeoftrial: 'demo',
          Experiment: jsPsych.timelineVariable('Experiment'),
        }
};

    var demo_3 = {
      type: jsPsychSurveyMultiChoice,
      questions: [
      {
          prompt: "Are you of Hispanic, Latino/a/x or of Spanish origin?", 
          name: 'Latino', 
          options: ['Yes', 'No', 'Prefer not to respond'], 
          required: false
        }, 
        {
          prompt: "What is your dominant hand?", 
          name: 'DominantHand', 
          options: ['Left', 'Right', 'Ambidexterous'], 
          required: false
        }, 
        {
          prompt: "Please indicate what time of the day you feel most alert:", 
          name: 'Alert', 
          options: ['Morning', 'Afternoon', 'Evening', 'No Differences'], 
          required: false
        },
      ],
        data: {
          typeoftrial: 'demo',
          Experiment: jsPsych.timelineVariable('Experiment'),
        }
    };

  var english = {
      type: jsPsychSurveyMultiChoice,
      questions: [
        {
          prompt: "Is English your first language?", 
          name: 'English', 
          options: ['Yes', 'No'], 
          required: true
        },
      ],
        data: {
          typeoftrial: 'english',
          Experiment: jsPsych.timelineVariable('Experiment'),
        }
    };


var not_english = {
type: jsPsychSurveyText,
preamble: "<p> You indicated that English is not your first language in the previous question. Please answer the following questions:</p> ",
questions: [ {prompt: "What is your first language?"},
{prompt: "At what age did you learn English?"} ],
data: {
          typeoftrial: 'notenglish',
          Experiment: jsPsych.timelineVariable('Experiment'),
        }
}

var not_english_loop = {
timeline: [not_english],
conditional_function: function() {
var dat = jsPsych.data.getLastTrialData().values()[0];
var answer = JSON.stringify(dat.response.English);
answer = answer.replace(/\W/g, '')
if(answer.localeCompare("No") == 0) {return true;} 
else {return false;}
}
}

var demo_5 = {
type: jsPsychSurveyText,
questions: [ {prompt: "Is there anything else we should know about, which might have affected your performance during the experiment? (e.g., lack of sleep, feeling ill etc.)"},
 ],
data: {
          typeoftrial: 'demo',
          Experiment: jsPsych.timelineVariable('Experiment'),
        }
}

	var demo_procedure = {
      timeline: [demo_1, demo_2,demo_3, english, not_english_loop, demo_5]
    }
    
  timeline.push(demo_procedure)



    var endexperiment = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `<p>Thank you for participating! </p>
        <p> Please click <a href="https://bit.ly/3GHKbaL" target="_blank" rel="noopener noreferrer">here</a> to access the debriefing form and know more about our research.</p>
        <p> Please click the button below to finish the experiment and save your data.</p>
        <p> IMPORTANT: Please do not leave this page without clicking the button below.</p>
          `,
        choices: ['Finish and Save Data']
    };
    
  timeline.push(endexperiment)


function find_list(condition_number){
  var stimuli = []
  if(condition_number == 1){
    stimuli = list1
  }
  else if(condition_number == 2){
    stimuli = list2
  }
  else if(condition_number ==3){
    stimuli = list3
  }
  else if(condition_number == 4){
    stimuli = list4
  }
  else if(condition_number == 5){
    stimuli = list5
  }
  else if(condition_number == 6){
    stimuli = list6
  }
  else if(condition_number == 7){
    stimuli = list7
  }
  else if(condition_number == 8){
    stimuli = list8
  }
  else if(condition_number == 9){
    stimuli = list9
  }
  else if(condition_number == 10){
    stimuli = list10
  }
  else if(condition_number == 11){
    stimuli = list11
  }
  else {
    stimuli = list12
  }


  // fill out rest of the conditions here

  return stimuli

}

function extract_json_subset(json_list, domain_name){

      const filtered_json = json_list.filter(({domain}) => domain === domain_name);
      return filtered_json
    }

    
      //timeline.push(demo_procedure);
      //timeline.push(endexperiment);
      
      jsPsych.run(timeline);


      



</script>
</body>

</html>